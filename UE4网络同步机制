一 UE4网络同步机制

1，UE4中有哪些同步机制？？
(1) Actor Replication (最基本的复制单位)
(2) Property Replication (属性同步)
(3) Function Call Replication (函数调用复制--RPC)
(4) Actor Component Replication (Actor 组件复制)
(5) Generatic SubObject Replication (UObject 复制)


2,UE4有哪些服务器模式？
(1) Listen Server:监听服务器，即局域网内进行本地游戏，此时本地机器即是客户端，也是服务器

(2) 独立服务器，即Dedicated Server，简称DS,也叫做专用服务器，此时它的功能纯粹作为服务器，不进行渲染功能，只执行服务器逻辑，默认情况下连界面都没有，除非在在启动参数加入-log

注意：

游戏中的数据都是由服务器来同步给客户端，不同客户端之间是没有直接交互的，必须通过服务器告知，客户端的数据都是通过服务器来校准，网络好的客户端，数据更接近服务器，网络差的客户端，数据差异

更大，客户端发信息给服务器，只有一种方式，那就是通过RPC-Server一种方式，除此无它！

二 各种同步机制详解：

1 Actor Replication：

Actor是UE4 网络传输的基本单位，RPC,Property，或者Actor Component复制，都是得在Actor中执行，不得脱离Actor，所以说Actor是网络复制的基本单位，当Actor发生变化时，引擎会在预设时间内
对该Actor进行同步，从而使得拥有该Actor的所有客户端，得到同步，但是一般来说，UE4并不知道，哪些Actor，需要复制，因为默认是关闭复制的（复制需要消耗带宽），所以需要手动打开复制属性，

两种方式打开Actor的复制属性：
（1）c++方式：
属性：bReplicates 赋值为1 即可

(2)蓝图方式：
属性面板，勾上Replicates属性，即可

问题，如何让Actor，只同步给部分玩家，比如只同步给拥有者，只同步给一定距离范围内的玩家，只同步给付费玩家？

涉及到一个概念：network relavant概念，即网络相关性，作用？：通过指定网络相关性，比如bOnlyRelavantToOwner变量设置为true，那么Actor就只同步给拥有该Actor的玩家,而其他的玩家不会

得到同步！也就是说，只有当Actor设置为Relavant 服务器，跟服务器相关，才会得到服务器的同步！

如果想要属性只同步给一定距离范围内的玩家？可以通过设置属性Actor::NetCullDistanceSquared，设置裁剪距离，也就是在此距离范围内的玩家，都会得到同步更新，超过范围的玩家，不生效

如果想要只同步给特定条件的玩家，比如付费玩家呢？没有具体的变量可以设置，但是可以通过重载一个函数，override IsNetRelavantFor 函数，设置条件，从而达到目的



2 Propery Replication

属性复制：当把Actor的Replicates属性设置为true后，并不是所有属性都会同步复制，而是要通过指定哪些属性需要复制，服务器才会进行同步，属性复制有两种方式：

（1）当属性发生变化时，服务器直接同步给客户端，

c++:

UPROPERTY(EditAnywhere,BlueprintReadWrite,Replicated,Category = Health)
float health = 0.0;

蓝图：在属性面板，将Replication属性，设置为Replicated即可

(2)第二种，服务器同步属性给客户端时，还会触发On_Rep()函数，c++ 和蓝图，处理方式不一样：

c++：
当属性在服务器上发生变化的时候，客户端会自动触发On_Rep()函数，无需手动调用，而如果是在服务端，则需要手动调用On_Rep()函数，在函数声明中，需要加入Replicated_Using关键字，此时的
On_Rep()函数，就只会在服务端去调用，此种情况，用于客户端发消息给服务端，同步服务端的数据，即把客户端的数据同步给服务端，声明方式如下：

客户端：
UFUNCTION()
void OnRep_Score();即可

服务端：
UPROPERTY(Replicated_Using = OnRep_Score)
float Score;

UFUNCTION()
void OnRep_Score();

蓝图：

把属性的Replication属性设置为RepNotify,同时，需要声明一个函数：OnRep_Score函数

注意：
在c++中设置属性同步时，不管是在客户端，还是服务端操作，都需要设置属性的Lifetime，设置Lifetime，就是重载Actor::GetLiftTimeReplicatedPros函数，这个函数会在类的第一个实例调用，
是第一个实例初始化调用，而不是每个实例初始化调用，也就是说这个LifeTime的设置是基于类本身，而不是实例本身！！


